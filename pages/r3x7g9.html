<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resultados</title>
  <link rel="stylesheet" href="../css/jIh3aOq.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="../js/exportador.js"></script>

</head>
<body>
  <div class="login-container">
    <h2>Resultados Diputados</h2>
    <canvas id="graficoDiputados"></canvas>

    <h2>Resultados Concejales</h2>
    <canvas id="graficoConcejales"></canvas>

    <button onclick="verPlantillas()">Ver plantillas escrutinio</button>
    <div id="plantillas-container"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore-compat.js"></script>
  <script src="../js/x2BkaL9e.js"></script>

  <script>
    const db = firebase.firestore();
    const listas = [
      "UNION POR LA PATRIA", "JUNTOS POR EL CAMBIO", "LA LIBERTAD AVANZA",
      "FRENTE DE IZQUIERDA", "VOTOS EN BLANCO", "NULOS", "RECURRIDOS"
    ];

    const totales = {};
    listas.forEach(l => totales[l] = { diputados: 0, concejales: 0 });

    db.collection("escrutinios").get().then(snapshot => {
      snapshot.forEach(doc => {
        const votos = doc.data().votos;
        listas.forEach(lista => {
          totales[lista].diputados += votos[lista].diputados;
          totales[lista].concejales += votos[lista].concejales;
        });
      });

      const diputadosData = listas.map(l => totales[l].diputados);
      const concejalesData = listas.map(l => totales[l].concejales);

      new Chart(document.getElementById("graficoDiputados"), {
        type: "pie",
        data: {
          labels: listas,
          datasets: [{ data: diputadosData }]
        }
      });

      new Chart(document.getElementById("graficoConcejales"), {
        type: "pie",
        data: {
          labels: listas,
          datasets: [{ data: concejalesData }]
        }
      });
    });

    <button onclick="exportarExcel()">Exportar a Excel</button>


    function verPlantillas() {
      db.collection("escrutinios").get().then(snapshot => {
        const container = document.getElementById("plantillas-container");
        container.innerHTML = "";

        const porEscuela = {};

        snapshot.forEach(doc => {
          const data = doc.data();
          const mesa = data.mesa;
          const url = data.urlFoto;
          const dni = data.dni;

          if (!porEscuela[dni]) porEscuela[dni] = [];
          porEscuela[dni].push({ mesa, url });
        });

        for (const dni in porEscuela) {
          const grupo = porEscuela[dni];
          const div = document.createElement("div");
          div.innerHTML = `<h3>Fiscal DNI: ${dni}</h3>`;
          grupo.forEach(foto => {
            div.innerHTML += `
              <div>
                <strong>Mesa ${foto.mesa}</strong><br>
                <img src="${foto.url}" width="100%" style="max-width:300px; margin-bottom:10px" />
              </div>
            `;
          });
          container.appendChild(div);
        }
      });
    }
  </script>
</body>
</html>
